**网络协议**

协议 (protocol) 定义了在两个或多个通信实体之间交换的报文的格式和顺 序，以及报文发送和或接收一条报文或其他事件所采取的动作

掌握计算机网络领域知识的过程就是理解网络协议的构成原理和工作方式的过程。

**网络边缘**

处于互联网的边缘，与因特网相连的计算机和其他设备称为端系统。包括了桌面计算机、服务器、和移动计算机。

网络核心<——>主机 互相连接

端系统（主机）

+ 运行应用程序
+ 如Web、email

C/S模式

+ 客户端向服务器请求、接收服务

对等(peer-peer)模式（迅雷P2P

+ 没有专门的服务器

### **网络核心：电路交换**

 端到端的资源被分配给从源端 到目标端的呼叫 “call”

![image-20221006205931503](https://cdn.jsdelivr.net/gh/0xmelon/picgohub@master/imgs/image-20221006205931503.png)

图中，每段链路有4条线路： 

+ 该呼叫采用了上面链路的第2 个线路，右边链路的第1个线路（piece） 

+ 独享资源：不同享 

  每个呼叫一旦建立起来就能够 保证性能 

  如果呼叫没有数据发送，被分配 的资源就会被浪费 (no sharing) 

  通常被传统电话网络采用k

<img src="https://cdn.jsdelivr.net/gh/0xmelon/picgohub@master/imgs/image-20221006195008733.png" style="zoom:33%;" />

为呼叫预留端-端资源 

+ 链路带宽、交换能力 
+ 专用资源：不共享 
+ 保证性能 
+ 要求建立呼叫连

**电路交换不适合计算机之间的通信**

+ 连接建立时间长
+ 计算机之间的通信有突发性，如果使用线路交 换，则浪费的片较多  
  + 即使这个呼叫没有数据传递，其所占据的片也不能 够被别的呼叫使用

### **网络核心：分组交换**

+ 以分组为单位储存
  + 网络带宽资源不再分分为一个个片，传输时使用全部带宽
  + 主机之间传输的数据被分为一 个个分组
+ 资源共享，按需使用
  + 存储-转发：分组每次移 动一跳
    + 在转发之前，节点必须收到 整个分组
    + 延迟比线路交换要大
    + 排队时间

**分组交换 vs. 电路交换**

分组交换是“突发数据的胜利者？”

+ 适合于对突发式数据传输
  + 资源共享
  + 简单，不必建立呼叫
+ 过度使用会造成网络拥塞：分组延时和丢失
  + 对可靠地数据传输需要协议来约束：拥塞控制

**分组交换网络：存储-转发**

+ 分组交换: 分组的存储转发一段一段从源端传到目标端 ，按照有无网络层的连接，分为
  1. 数据报网络
     + 分组的目标地址决定下一跳
     + 在不同的阶段，路由可以改变
  2. 虚电路网络：
     + 每个分组都带标签（虚电路标识 VC ID），标签决定下一跳
     + 在呼叫建立时决定路径，在整个呼叫中路径保持不变
     + 路由器维持每个呼叫的状态信息

### **数据报的工作原理**

+ 在通信之前,无须建立起一个连接,有数据就传输
+ 每一个分组都独立路由(路径不一样,可能会失序)
+ 路由器根据分组的目标地址进行路由

![image-20221007102959687](https://cdn.jsdelivr.net/gh/0xmelon/picgohub@master/imgs/image-20221007102959687.png)

**接入网和物理媒体** 

+ 住宅接入：modem

+ 接入网: digital subscriber line (DSL)

+ 物理媒体：同轴电缆、光纤

### **网络结构和ISP**

+ ISPs (Internet Service Providers)：因特网服务提供商

+ 中心：第一层ISP（如UUNet, BBN/Genuity, Sprint,  AT&T）国家/国际覆盖，速率极高
  + 直接与其他第一层ISP相吃连
  + 与大量的第二层ISP和其他客户网络相连

<img src="https://cdn.jsdelivr.net/gh/0xmelon/picgohub@master/imgs/image-20221007114949144.png" alt="image-20221007114949144" style="zoom:50%;" />

+ 第二层ISP: 更小些的 (通常是区域性的) ISP
  + 与一个或多个第一层ISPs，也可能与其他第二层ISP

<img src="https://cdn.jsdelivr.net/gh/0xmelon/picgohub@master/imgs/image-20221007115043389.png" alt="image-20221007115043389" style="zoom:50%;" />

+ 第三层ISP与其他本地ISP
  + 接入网 (与端系统最近)

<img src="https://cdn.jsdelivr.net/gh/0xmelon/picgohub@master/imgs/image-20221007115135198.png" alt="image-20221007115135198" style="zoom: 50%;" />

+ ISP之间的连接
  + POP：高层ISP面向客户网络的接入点，涉及费用结算
    + 如一个低层ISP接入多个高层ISP，多宿（multi home）
  + 对等接入：2个ISP对等互接，不涉及费用结算
  + IXP：多个对等ISP互联互通之处，通常不涉及费用结算
  + ICP：自己部署专用网络，同时和各级ISP连接

<img src="https://cdn.jsdelivr.net/gh/0xmelon/picgohub@master/imgs/image-20221007115555904.png" alt="image-20221007115555904" style="zoom:67%;" />

### **分组延时**

节点处理延时：nodal processing

+  通常是微秒数量级或更

排队延时：queueing

+ 取决于拥塞程度

传输延时：transmission 

+ = L/R, 对低速率的链路而言很大（如拨号），通常为微秒级 到毫秒级

传播延时：propagation

+ 几微秒到几百毫秒

<img src="https://cdn.jsdelivr.net/gh/0xmelon/picgohub@master/imgs/202210091652256.png" alt="image-20221009165208210" style="zoom:50%;" />

**分组丢失**

+ 链路的队列缓冲区容量有限
+ 当分组到达一个满的队列时，该分组将会丢失 
+ 丢失的分组可能会被前一个节点或源端系统重传，或根本不重传

 Ps: TTL的概念:ICMP包的转发次数（跳数）,最大值是255,每经过一个路由器，路由器都会修改这个TTL字段值，具体的做法是把该TTL的值减1，然后再将IP包转发出去。如果在IP包到达目的IP之前，TTL减少为0，路由器将会丢弃收到的TTL=0的IP包并向IP包的发送者发送 ICMP time exceeded消息

**吞吐量**

在源端和目标端之间传输的速率（数据量/单位时间）

+ *瞬间吞吐量:* 在一个时间点的速率
+ *平均吞吐量:* 在一个长时间内平均

+ 瓶颈链路：端到端路径上，限制端到端吞吐的链路

### 协议层次

**服务和服务访问点**

+ 服务：低层实体向上层实体提供它们之间的通信的能力

+ 原语（API）：上层使用下层服务的形式，高层使用低层提供的服务，以及低层向高层提供服务都是通过服务访问原语来进行交互的---形式

+ 服务访问点 SAP (Services Access Point) ：上层使用下层提供的服务通过层间的接口—地点 Ps : 传输层端口SAP

**服务与协议**

+ 服务(Service)：低层实体向上层实体提供它们之间的通信的能力，是通过原语(primitive)来操作的，垂直

+ 协议(protocol) ：对等层实体(peer entity)之间在相互通信的过程中，需要遵循的规则的集合，水平

关系

+ 本层协议的实现要靠下层提供的服务来实现 
+ 本层实体通过协议为上层提供更高级

**数据单元**

<img src="https://cdn.jsdelivr.net/gh/0xmelon/picgohub@master/imgs/202210100948378.png" alt="image-20221010094835303" style="zoom:33%;" />
$$
关系：一对多、一对一、多对多
$$
**Internet 协议栈**

+ 应用层: 网络应用 
  + 为人类用户或者其他应用进程提供网络应用服务 
  + FTP, SMTP, HTTP,DNS 

+ 传输层: 主机之间的数据传输 
  + 在网络层提供的端到端通信基础上，细分为进程到进程，将不可靠的通信变成可靠地通信 
  + TCP, UDP 
+ 网络层: 为数据报从源到目的选择路由 
  + 主机主机之间的通信，端到端通信，不可靠 
  + IP, 路由协议 
+ 链路层: 相邻网络节点间的数据传输 
  + 2个相邻2点的通信，点到点通信，可靠或不可靠 
  + 点对对协议PPP, 802.11(Wi-Fi), Ethernet 
+ 物理层: 在线路上传送bit

**参考模型**

+ 表示层: 允许应用解释传输的 数据  eg. 加密，压缩，机 器相关的表示转换

+ 会话层: 数据交换的同步，检查点，恢复

<img src="https://cdn.jsdelivr.net/gh/0xmelon/picgohub@master/imgs/202210101330723.png" alt="image-20221010133003673" style="zoom:33%;" />

**协议数据单元**

+ 应用层：报文(message) 
+ 传输层：报文段(segment)：TCP段，UDP数据报 
+ 网络层：分组packet（如果无连接方式：数据报 datagram） 
+ 数据链路层：帧(frame) 
+ 物理层：位(bit)

### Internet历史

+ **早期（1960年以前的）网络**
  + 线路交换网络 
  + 线路交换的特性使得其不适合计算机之间的通信 
    + 线路建立时间过长 
    + 独享方式占用通信资源，不适合突发性很强的计算机之间的通信 
    + 可靠性不高：非常不适合军事通信 
  + 三个小组独立地开展分组交换的研究 

+ **1961-1972: 早期的分组交换概念**

  <img src="https://cdn.jsdelivr.net/gh/0xmelon/picgohub@master/imgs/202210111533731.png" alt="image-20221011153340655" style="zoom:50%;" />

+ **1972-1980: 专用网络和网络互联**

<img src="https://cdn.jsdelivr.net/gh/0xmelon/picgohub@master/imgs/202210111534382.png" alt="image-20221011153431328" style="zoom:50%;" />

+ **1980-1990: 体系结构变化, 网络数量激增，应用丰富**

<img src="https://cdn.jsdelivr.net/gh/0xmelon/picgohub@master/imgs/202210111535086.png" alt="image-20221011153514037" style="zoom:50%;" />

+ **1990, 2000’s: 商业化, Web, 新的应用**

<img src="https://cdn.jsdelivr.net/gh/0xmelon/picgohub@master/imgs/202210111537020.png" alt="image-20221011153738964" style="zoom:50%;" />

+ **2005-现在**

<img src="https://cdn.jsdelivr.net/gh/0xmelon/picgohub@master/imgs/202210111556676.png" alt="image-20221011155618628" style="zoom:50%;" />

### 小结

组成角度看什么是互联网 

+ 边缘：端系统（包括应用）+接入网 

+ 核心：网络交换设备+通信链路 

+ 协议：对等层实体通信过程中遵守的规则的集合 
  + 语法，语义，时序 
  

为了实现复杂的网络功能，采用分层方式设计、实现和调试 
  + 应用层，传输层，网络层，数据链路层，物理层 
  + 协议数据单位：  报文，报文段，分组，帧，位 

从 服务角度看互联网 
  + 通信服务基础设施 
    + 提供的通信服务：面向连接 无连接 
    
  + 应用 

应用之间的交互 
  +  C/S模式 
  + P2P模式